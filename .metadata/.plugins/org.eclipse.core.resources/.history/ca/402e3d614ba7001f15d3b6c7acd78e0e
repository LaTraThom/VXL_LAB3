/*
 * fsm_automatic.c
 *
 *  Created on: Nov 15, 2024
 *      Author: TIEN DUY
 */

#include "fsm_automatic.h"
#include "traffic_light.h"
#include "global.h"
int RED_TIME = 500;
int YELLOW_TIME = 200;
int GREEN_TIME = 300;
int status = INIT;
void fsm_automatic(){
	switch (status){
		case INIT:
			HAL_GPIO_WritePin(LED_1_RED_GPIO_Port, LED_1_RED_Pin, SET);
			HAL_GPIO_WritePin(LED_2_GREEN_GPIO_Port, LED_2_GREEN_Pin, SET);
			HAL_GPIO_WritePin(LED_3_YELLOW_GPIO_Port, LED_3_YELLOW_Pin, SET);
			HAL_GPIO_WritePin(LED_4_RED_GPIO_Port, LED_4_RED_Pin, SET);
			HAL_GPIO_WritePin(LED_5_GREEN_GPIO_Port, LED_5_GREEN_Pin, SET);
			HAL_GPIO_WritePin(LED_6_YELLOW_GPIO_Port, LED_6_YELLOW_Pin, SET);
			HAL_GPIO_WritePin(LED_7_RED_GPIO_Port, LED_7_RED_Pin, SET);
			HAL_GPIO_WritePin(LED_8_GREEN_GPIO_Port, LED_8_GREEN_Pin, SET);
			HAL_GPIO_WritePin(LED_9_YELLOW_GPIO_Port, LED_9_YELLOW_Pin, SET);
			HAL_GPIO_WritePin(LED_10_RED_GPIO_Port, LED_10_RED_Pin, SET);
			HAL_GPIO_WritePin(LED_11_GREEN_GPIO_Port, LED_11_GREEN_Pin, SET);
			HAL_GPIO_WritePin(LED_12_YELLOW_GPIO_Port, LED_12_YELLOW_Pin, SET);
			status =  AUTO_RED_GREEN;
			led7_segment(RED_GREEN);
			setTimer1(GREEN_TIME);
			break;
		case AUTO_RED_GREEN:
			traffic_light(RED_GREEN);
			if (timer1_flag == 1) {
				timer1_flag = 0;
				status = AUTO_RED_YELLOW;
				led7_segment(RED_YELLOW);
				setTimer1(YELLOW_TIME);
			}
			break;
		case AUTO_RED_YELLOW:
			traffic_light(RED_YELLOW);
			if (timer1_flag == 1) {
				timer1_flag = 0;
				status = AUTO_GREEN_RED;
				led7_segment(GREEN_RED);
				setTimer1(GREEN_TIME);
			}
			break;
		case AUTO_GREEN_RED:
			traffic_light(GREEN_RED);
			if (timer1_flag == 1) {
				timer1_flag = 0;
				status = AUTO_YELLOW_RED;
				led7_segment(YELLOW_RED);
				setTimer1(YELLOW_TIME);
			}
			break;
		case AUTO_YELLOW_RED:
			traffic_light(YELLOW_RED);
			if (timer1_flag == 1) {
				timer1_flag = 0;
				status = AUTO_RED_GREEN;
				led7_segment(RED_GREEN);
				setTimer1(GREEN_TIME);
			}
			break;
		default:
			break;
	}
}
